<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶° - ‡¶®‡¶ø‡¶â‡¶ú ‡¶™‡ßã‡¶∞‡ßç‡¶ü‡¶æ‡¶≤</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <div class="admin-layout">
        <!-- Sidebar -->
        <aside class="admin-sidebar">
            <div class="logo">üì∞ ‡¶®‡¶ø‡¶â‡¶ú ‡¶™‡ßã‡¶∞‡ßç‡¶ü‡¶æ‡¶≤</div>
            <nav class="admin-menu">
                <a href="dashboard.html" class="active">üìä ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</a>
                <a href="articles.html">üìù ‡¶Ü‡¶∞‡ßç‡¶ü‡¶ø‡¶ï‡ßá‡¶≤</a>
                <a href="categories.html">üìÅ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø</a>
                <a href="users.html" id="usersLink">üë• ‡¶á‡¶â‡¶ú‡¶æ‡¶∞</a>
                <a href="../index.html">üè† ‡¶π‡ßã‡¶Æ‡¶™‡ßá‡¶ú</a>
                <a href="#" onclick="logout()">üö™ ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="admin-content">
            <div class="admin-header">
                <h1>‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</h1>
                <span id="welcomeUser"></span>
            </div>

            <!-- Stats -->
            <div class="stats-grid" id="statsGrid">
                <div class="stat-card">
                    <h3>‡¶Æ‡ßã‡¶ü ‡¶Ü‡¶∞‡ßç‡¶ü‡¶ø‡¶ï‡ßá‡¶≤</h3>
                    <div class="number" id="totalArticles">-</div>
                </div>
                <div class="stat-card">
                    <h3>‡¶Æ‡ßã‡¶ü ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø</h3>
                    <div class="number" id="totalCategories">-</div>
                </div>
                <div class="stat-card">
                    <h3>‡¶Æ‡ßã‡¶ü ‡¶á‡¶â‡¶ú‡¶æ‡¶∞</h3>
                    <div class="number" id="totalUsers">-</div>
                </div>
                <div class="stat-card">
                    <h3>‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶≠‡¶ø‡¶â</h3>
                    <div class="number" id="todayViews">-</div>
                </div>
            </div>

            <!-- Recent Articles -->
            <div class="table-container">
                <div class="table-header">
                    <h3>‡¶∏‡¶∞‡ßç‡¶¨‡¶∂‡ßá‡¶∑ ‡¶Ü‡¶∞‡ßç‡¶ü‡¶ø‡¶ï‡ßá‡¶≤</h3>
                    <a href="article-form.html" class="btn btn-primary">+ ‡¶®‡¶§‡ßÅ‡¶® ‡¶Ü‡¶∞‡ßç‡¶ü‡¶ø‡¶ï‡ßá‡¶≤</a>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ</th>
                            <th>‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø</th>
                            <th>‡¶≤‡ßá‡¶ñ‡¶ï</th>
                            <th>‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏</th>
                            <th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
                        </tr>
                    </thead>
                    <tbody id="recentArticles">
                        <tr><td colspan="5" class="text-center">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</td></tr>
                    </tbody>
                </table>
            </div>
        </main>
    </div>

    <script src="../js/config.js"></script>
    <script src="../js/api.js"></script>
    <script src="../js/auth.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            if (!requireAdmin()) return;
            
            const user = getCurrentUser();
            const fullName = [user.firstName, user.lastName].filter(Boolean).join(' ') || user.username || 'Admin';
            document.getElementById('welcomeUser').textContent = `‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ, ${fullName}`;
            
            // Hide users link for editors
            if (user.role === 'editor') {
                const usersLink = document.getElementById('usersLink');
                if (usersLink) usersLink.style.display = 'none';
            }
            
            loadDashboardData();
        });

        async function loadDashboardData() {
            try {
                // Load articles
                const articlesRes = await ArticlesAPI.getAll('?limit=5');
                const articles = articlesRes.data || articlesRes;
                document.getElementById('totalArticles').textContent = articlesRes.total || articles.length;
                
                // Render recent articles
                const tbody = document.getElementById('recentArticles');
                if (articles.length > 0) {
                    tbody.innerHTML = articles.map(article => `
                        <tr>
                            <td><a href="../article.html?id=${article.id}">${truncateText(article.title, 40)}</a></td>
                            <td>${article.category?.name || '-'}</td>
                            <td>${article.author?.firstName || '-'}</td>
                            <td><span class="badge ${article.status === 'published' ? 'badge-success' : 'badge-warning'}">${article.status === 'published' ? '‡¶™‡ßç‡¶∞‡¶ï‡¶æ‡¶∂‡¶ø‡¶§' : '‡¶°‡ßç‡¶∞‡¶æ‡¶´‡¶ü'}</span></td>
                            <td>${formatDate(article.createdAt)}</td>
                        </tr>
                    `).join('');
                } else {
                    tbody.innerHTML = '<tr><td colspan="5" class="text-center">‡¶ï‡ßã‡¶® ‡¶Ü‡¶∞‡ßç‡¶ü‡¶ø‡¶ï‡ßá‡¶≤ ‡¶®‡ßá‡¶á</td></tr>';
                }

                // Load categories
                const categoriesRes = await CategoriesAPI.getAll();
                const categories = categoriesRes.data || categoriesRes;
                document.getElementById('totalCategories').textContent = categories.length;

                // Load users
                const usersRes = await UsersAPI.getAll();
                const users = usersRes.data || usersRes;
                document.getElementById('totalUsers').textContent = users.length;

                // Today's views (placeholder)
                document.getElementById('todayViews').textContent = '0';

            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }
    </script>
</body>
</html>
