<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶ñ‡¶¨‡¶∞ - ‡¶®‡¶ø‡¶â‡¶ú ‡¶™‡ßã‡¶∞‡ßç‡¶ü‡¶æ‡¶≤</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container nav-container">
            <a href="index.html" class="logo">üì∞ ‡¶®‡¶ø‡¶â‡¶ú ‡¶™‡ßã‡¶∞‡ßç‡¶ü‡¶æ‡¶≤</a>
            <div class="nav-menu">
                <a href="index.html" class="nav-link">‡¶π‡ßã‡¶Æ</a>
                <a href="articles.html" class="nav-link">‡¶∏‡¶¨ ‡¶ñ‡¶¨‡¶∞</a>
                <div class="dropdown">
                    <a href="#" class="nav-link dropdown-toggle">‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø</a>
                    <div class="dropdown-menu" id="categoryDropdown"></div>
                </div>
            </div>
            <div class="nav-auth" id="navAuth">
                <a href="login.html" class="btn btn-outline">‡¶≤‡¶ó‡¶á‡¶®</a>
                <a href="register.html" class="btn btn-primary">‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞</a>
            </div>
            <div class="nav-user" id="navUser" style="display: none;">
                <span id="userName"></span>
                <a href="profile.html" class="btn btn-outline">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</a>
                <button class="btn btn-secondary" onclick="logout()">‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</button>
            </div>
        </div>
    </nav>

    <!-- Article Content -->
    <section class="section">
        <div class="container">
            <div class="article-detail" id="articleContent">
                <div class="loading">
                    <div class="spinner"></div>
                    ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...
                </div>
            </div>
        </div>
    </section>

    <!-- Related Articles -->
    <section class="section section-gray">
        <div class="container">
            <h2 class="section-title">‡¶∏‡¶Æ‡ßç‡¶™‡¶∞‡ßç‡¶ï‡¶ø‡¶§ ‡¶ñ‡¶¨‡¶∞</h2>
            <div class="articles-grid" id="relatedArticles">
                <div class="loading">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-bottom">
                <p>&copy; 2026 ‡¶®‡¶ø‡¶â‡¶ú ‡¶™‡ßã‡¶∞‡ßç‡¶ü‡¶æ‡¶≤‡•§ ‡¶∏‡¶∞‡ßç‡¶¨‡¶∏‡ßç‡¶¨‡¶§‡ßç‡¶¨ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§‡•§</p>
            </div>
        </div>
    </footer>

    <script src="js/config.js"></script>
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script>
        let currentArticle = null;

        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const articleId = urlParams.get('id');
            
            if (articleId) {
                loadArticle(articleId);
            } else {
                document.getElementById('articleContent').innerHTML = '<p class="text-center">‡¶ñ‡¶¨‡¶∞ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø</p>';
            }
        });

        async function loadArticle(id) {
            const container = document.getElementById('articleContent');
            
            try {
                const article = await ArticlesAPI.getOne(id);
                currentArticle = article;
                
                // Update page title
                document.title = `${article.title} - ‡¶®‡¶ø‡¶â‡¶ú ‡¶™‡ßã‡¶∞‡ßç‡¶ü‡¶æ‡¶≤`;
                
                container.innerHTML = `
                    <img src="${article.imageUrl || 'https://via.placeholder.com/800x400?text=News'}" alt="${article.title}">
                    <h1>${article.title}</h1>
                    <div class="meta">
                        <span>üìÅ <a href="category.html?id=${article.categoryId}">${article.category?.name || '‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£'}</a></span>
                        <span>‚úçÔ∏è ${article.author?.firstName || '‡¶Ö‡¶ú‡¶æ‡¶®‡¶æ'}</span>
                        <span>üìÖ ${formatDate(article.createdAt)}</span>
                        <span>üëÅÔ∏è ${article.viewCount || 0} ‡¶¨‡¶æ‡¶∞ ‡¶™‡¶°‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá</span>
                    </div>
                    <div class="content">
                        ${(article.content || '').split('\n').map(p => `<p>${p}</p>`).join('')}
                    </div>
                    <div style="margin-top: 30px;">
                        <a href="articles.html" class="btn btn-outline">‚Üê ‡¶∏‡¶¨ ‡¶ñ‡¶¨‡¶∞ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</a>
                    </div>
                `;
                
                // Load related articles
                if (article.categoryId) {
                    loadRelatedArticles(article.categoryId, article.id);
                }
            } catch (error) {
                container.innerHTML = '<p class="text-center">‡¶ñ‡¶¨‡¶∞ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá</p>';
                console.error('Error loading article:', error);
            }
        }

        async function loadRelatedArticles(categoryId, currentId) {
            const container = document.getElementById('relatedArticles');
            
            try {
                const response = await ArticlesAPI.getByCategory(categoryId);
                let articles = response.data || response;
                
                // Filter out current article
                articles = articles.filter(a => a.id !== parseInt(currentId)).slice(0, 3);
                
                if (articles.length === 0) {
                    container.innerHTML = '<p class="text-center" style="grid-column: 1/-1;">‡¶ï‡ßã‡¶® ‡¶∏‡¶Æ‡ßç‡¶™‡¶∞‡ßç‡¶ï‡¶ø‡¶§ ‡¶ñ‡¶¨‡¶∞ ‡¶®‡ßá‡¶á</p>';
                    return;
                }
                
                container.innerHTML = articles.map(article => `
                    <div class="article-card">
                        <img src="${article.imageUrl || 'https://via.placeholder.com/400x200?text=News'}" alt="${article.title}">
                        <div class="article-card-body">
                            <span class="category">${article.category?.name || '‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£'}</span>
                            <h3><a href="article.html?id=${article.id}">${article.title}</a></h3>
                            <div class="meta">
                                <span>üìÖ ${formatDate(article.createdAt)}</span>
                            </div>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                container.innerHTML = '<p class="text-center" style="grid-column: 1/-1;">‡¶∏‡¶Æ‡ßç‡¶™‡¶∞‡ßç‡¶ï‡¶ø‡¶§ ‡¶ñ‡¶¨‡¶∞ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá</p>';
                console.error('Error loading related articles:', error);
            }
        }
    </script>
</body>
</html>
