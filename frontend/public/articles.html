<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶∏‡¶¨ ‡¶ñ‡¶¨‡¶∞ - ‡¶®‡¶ø‡¶â‡¶ú ‡¶™‡ßã‡¶∞‡ßç‡¶ü‡¶æ‡¶≤</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container nav-container">
            <a href="index.html" class="logo">üì∞ ‡¶®‡¶ø‡¶â‡¶ú ‡¶™‡ßã‡¶∞‡ßç‡¶ü‡¶æ‡¶≤</a>
            <div class="nav-menu">
                <a href="index.html" class="nav-link">‡¶π‡ßã‡¶Æ</a>
                <a href="articles.html" class="nav-link active">‡¶∏‡¶¨ ‡¶ñ‡¶¨‡¶∞</a>
                <div class="dropdown">
                    <a href="#" class="nav-link dropdown-toggle">‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø</a>
                    <div class="dropdown-menu" id="categoryDropdown"></div>
                </div>
            </div>
            <div class="nav-auth" id="navAuth">
                <a href="login.html" class="btn btn-outline">‡¶≤‡¶ó‡¶á‡¶®</a>
                <a href="register.html" class="btn btn-primary">‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞</a>
            </div>
            <div class="nav-user" id="navUser" style="display: none;">
                <span id="userName"></span>
                <a href="profile.html" class="btn btn-outline">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</a>
                <button class="btn btn-secondary" onclick="logout()">‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</button>
            </div>
        </div>
    </nav>

    <!-- Page Header -->
    <section class="hero" style="padding: 40px 0;">
        <div class="container">
            <h1>‡¶∏‡¶¨ ‡¶ñ‡¶¨‡¶∞</h1>
            <p>‡¶∏‡¶∞‡ßç‡¶¨‡¶∂‡ßá‡¶∑ ‡¶∏‡¶Ç‡¶¨‡¶æ‡¶¶ ‡¶ì ‡¶Ü‡¶™‡¶°‡ßá‡¶ü</p>
        </div>
    </section>

    <!-- Search & Filter -->
    <section class="section" style="padding: 20px 0;">
        <div class="container">
            <div style="display: flex; gap: 20px; flex-wrap: wrap; align-items: center;">
                <input type="text" id="searchInput" class="form-control" placeholder="‡¶ñ‡¶¨‡¶∞ ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®..." style="max-width: 300px;">
                <select id="categoryFilter" class="form-control" style="max-width: 200px;">
                    <option value="">‡¶∏‡¶¨ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø</option>
                </select>
                <button class="btn btn-primary" onclick="filterArticles()">‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®</button>
            </div>
        </div>
    </section>

    <!-- Articles List -->
    <section class="section section-gray">
        <div class="container">
            <div class="articles-grid" id="articlesGrid">
                <div class="loading">
                    <div class="spinner"></div>
                    ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...
                </div>
            </div>
            
            <!-- Pagination -->
            <div class="pagination" id="pagination"></div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-bottom">
                <p>&copy; 2026 ‡¶®‡¶ø‡¶â‡¶ú ‡¶™‡ßã‡¶∞‡ßç‡¶ü‡¶æ‡¶≤‡•§ ‡¶∏‡¶∞‡ßç‡¶¨‡¶∏‡ßç‡¶¨‡¶§‡ßç‡¶¨ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§‡•§</p>
            </div>
        </div>
    </footer>

    <script src="js/config.js"></script>
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script>
        let currentPage = 1;
        let totalPages = 1;

        document.addEventListener('DOMContentLoaded', () => {
            loadCategoryFilter();
            loadArticles();
            
            // Search on Enter
            document.getElementById('searchInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') filterArticles();
            });
        });

        async function loadCategoryFilter() {
            try {
                const response = await CategoriesAPI.getAll();
                const categories = response.data || response;
                const select = document.getElementById('categoryFilter');
                
                categories.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat.id;
                    option.textContent = cat.name;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('Error loading categories:', error);
            }
        }

        async function loadArticles(page = 1) {
            const container = document.getElementById('articlesGrid');
            const search = document.getElementById('searchInput').value;
            const category = document.getElementById('categoryFilter').value;
            
            container.innerHTML = '<div class="loading"><div class="spinner"></div>‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>';
            
            try {
                let params = `?page=${page}&limit=9`;
                if (search) params += `&search=${encodeURIComponent(search)}`;
                if (category) params += `&categoryId=${category}`;
                
                const response = await ArticlesAPI.getAll(params);
                const articles = response.data || response;
                totalPages = response.totalPages || 1;
                currentPage = page;
                
                if (articles.length === 0) {
                    container.innerHTML = '<p class="text-center" style="grid-column: 1/-1;">‡¶ï‡ßã‡¶® ‡¶ñ‡¶¨‡¶∞ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø</p>';
                    document.getElementById('pagination').innerHTML = '';
                    return;
                }
                
                container.innerHTML = articles.map(article => `
                    <div class="article-card">
                        <img src="${article.imageUrl || 'https://via.placeholder.com/400x200?text=News'}" alt="${article.title}">
                        <div class="article-card-body">
                            <span class="category">${article.category?.name || '‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£'}</span>
                            <h3><a href="article.html?id=${article.id}">${article.title}</a></h3>
                            <p>${truncateText(article.content || article.summary || '', 100)}</p>
                            <div class="meta">
                                <span>‚úçÔ∏è ${article.author?.firstName || '‡¶Ö‡¶ú‡¶æ‡¶®‡¶æ'}</span>
                                <span>üìÖ ${formatDate(article.createdAt)}</span>
                            </div>
                        </div>
                    </div>
                `).join('');
                
                renderPagination();
            } catch (error) {
                container.innerHTML = '<p class="text-center" style="grid-column: 1/-1;">‡¶ñ‡¶¨‡¶∞ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá</p>';
                console.error('Error loading articles:', error);
            }
        }

        function filterArticles() {
            loadArticles(1);
        }

        function renderPagination() {
            const container = document.getElementById('pagination');
            
            if (totalPages <= 1) {
                container.innerHTML = '';
                return;
            }
            
            let html = '';
            
            if (currentPage > 1) {
                html += `<a href="#" onclick="loadArticles(${currentPage - 1}); return false;">¬´ ‡¶Ü‡¶ó‡ßá‡¶∞</a>`;
            }
            
            for (let i = 1; i <= totalPages; i++) {
                if (i === currentPage) {
                    html += `<span class="active">${i}</span>`;
                } else {
                    html += `<a href="#" onclick="loadArticles(${i}); return false;">${i}</a>`;
                }
            }
            
            if (currentPage < totalPages) {
                html += `<a href="#" onclick="loadArticles(${currentPage + 1}); return false;">‡¶™‡¶∞‡ßá‡¶∞ ¬ª</a>`;
            }
            
            container.innerHTML = html;
        }
    </script>
</body>
</html>
